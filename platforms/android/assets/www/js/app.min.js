var debug=!1,appController=function(){"use strict";function e(){n()}function n(){document.addEventListener("deviceready",i,!1)}function o(){$(".disable-overlay").addClass("show"),t(!0),$("body").append(v())}function t(e){e||$(".disable-overlay").removeClass("show"),$("body > .ajax-loader").remove()}function i(){FastClick.attach(document.body),$(document).on("touchend click",function(e){document.activeElement&&document.activeElement!==e.target&&document.activeElement.blur()}),$(document).on("click touchend","a",function(e){e.preventDefault(),showPageInAppBrowser($(this).attr("href"))}),document.addEventListener("backbutton",c,!1),Statusbar.start("#021326"),v=_.template($(".ajax-loader-template").html()),u(),globalEvent.notify("app:ready"),navigator.splashscreen.hide()}function c(e){e.preventDefault()}function u(){o(),l({onSuccess:function(){debug&&console.log("Ini done"),r(function(){t()})},onError:function(){debug&&console.error("didnt receieve ini!!"),t()}})}function r(e){var n=g.getToken();o(),n?s({onSuccess:function(){"function"==typeof e&&e(!0),t()},onError:function(){"function"==typeof e&&e(!1),t()},token:n}):(debug&&console.log("logging out as there is no user in"),globalEvent.notify("user:logout",{logoutNoPopup:!0}),t(),"function"==typeof e&&e(!1))}function s(e){handlerController.getinfo({hash:e.token},function(n){g.updateUser(n.d),globalEvent.notify("user:loggedin"),e&&e.onSuccess&&e.onSuccess()},function(n){return debug&&console.error("ERROR: "+n),e&&e.onError&&e.onError(n),!1})}function l(e){handlerController.content({},function(n){debug&&console.log("content recieved."),debug&&console.log(n),"undefined"!=typeof n.quizzes&&n.quizzes.length>0&&(d.removeQuizzes(),d.addQuizzes(n.quizzes)),"undefined"!=typeof n.lessons&&n.lessons.length>0&&(f.removeLessons(),f.addLessons(n.lessons)),"undefined"!=typeof n.wines&&n.wines.length>0&&(b.removeWines(),b.addWines(n.wines)),globalEvent.notify("ini:recieved"),p=!0,e&&e.onSuccess&&e.onSuccess()},function(n){debug&&console.log("Error! :"+n),globalEvent.notify("ini:notrecieved"),p=!1,e&&e.onError&&e.onError()})}var a={},d=quizzesModel,f=lessonsModel,g=userModel,v=null,p=!1,b=myWinesModel;return globalEvent.attach("app:ini",function(){u()}),globalEvent.attach("app:updateUser",function(e){r(function(n){"undefined"!=typeof arg&&"function"==typeof e.callback&&e.callback(n)})}),globalEvent.attach("user:loggedin",function(){p||u()}),e(),a}();