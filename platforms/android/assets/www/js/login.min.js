var loginView=function(){"use strict";var o={},n=null,e="loginView",t=null,i=!1;return o.backButtonClicked=new Event(e),o.loginButtonClicked=new Event(e),o.forgotPassButtonClicked=new Event(e),o.signUpButtonClicked=new Event(e),o.start=function(){$("#login").on("click",".mp3-header .icon-left",function(){o.backButtonClicked.notify()}),$("#login").on("click",".sign-in",function(){$("#login input").removeClass("invalid"),o.loginButtonClicked.notify({email:$("#login .input-email"),pass:$("#login .input-password")})}),$("#login").on("click",".forgotten-password",function(){o.forgotPassButtonClicked.notify()}),$("#login").on("click",".signup",function(){o.signUpButtonClicked.notify()}),$("#login").on("focus","input",function(){$(this).removeClass("invalid")}),n=new PageTransitions({el:"#login",transition:"left"}),t=_.template($(".ajax-loader-template").html())},o.show=function(o,e){i=!0,$("#login, .trans-overlay").addClass("active"),e=!$.isEmptyObject(e)&&e&&"undefined"!=typeof e.dir?e.dir:"left",n.in(e,null,function(){$(".trans-overlay").removeClass("active"),"function"==typeof o&&o()})},o.hide=function(o,e){i=!1,e=!$.isEmptyObject(e)&&e&&"undefined"!=typeof e.dir?e.dir:"left",n.out(e,null,function(){$("#login").removeClass("active"),"function"==typeof o&&o()})},o.clearDetails=function(){$("#login input").val("")},o.showLoader=function(){$(".disable-overlay").addClass("show"),o.hideLoader(!0),$("#login").append(t())},o.hideLoader=function(o){o||$(".disable-overlay").removeClass("show"),$("#login .ajax-loader").remove()},o}(),loginController=function(){"use strict";function o(o){if(a=!0,""===o.email.val()&&(o.email.addClass("invalid"),a=!1),""===o.pass.val()&&(o.pass.addClass("invalid"),a=!1),!a)return debug&&console.log("invalid cannot login"),!1;u.showLoader();var n={email:o.email.val(),token:o.pass.val()};handlerController.login(n,function(o){return debug&&console.log("ajax success, trying to log in, checking permissions"),debug&&console.log(o),r.createUser(o.d),debug&&console.log(r.getUser()),globalEvent.notify("user:loggedin"),globalEvent.notify("app:updateUser"),i.hide(!1,{dir:"left"}),globalEvent.notify("home:show",{dir:"right"}),u.hideLoader(),!0},function(o){return debug&&console.error("Failed to login: "+o),u.hideLoader(),"n/a"===o?(Popup.createConfirmPopup("Login unsuccessful","Invalid username/password",null,"Okay"),!1):(Popup.createConfirmPopup("Login unsuccessful","Please connect to the internet to login.",null,"Okay"),!1)})}function n(o){o.preventDefault(),i.hide(!1,{dir:"left"}),globalEvent.notify("home:show",{dir:"right"})}function e(){document.addEventListener("backbutton",n,!1)}function t(){document.removeEventListener("backbutton",n,!1)}var i={},l=!1,a=!0,r=userModel,u=loginView;return globalEvent.attach("app:ready",function(){i.start()}),globalEvent.attach("login:show",function(o){i.show(!1,o)}),globalEvent.attach("login:hide",function(o){i.hide(!1,o)}),u.backButtonClicked.attach(function(){i.hide(!1,{dir:"left"}),globalEvent.notify("home:show",{dir:"right"})}),u.loginButtonClicked.attach(function(n,e){o(e)}),u.forgotPassButtonClicked.attach(function(){i.hide(!1,{dir:"right"}),globalEvent.notify("forgottenpassword:show",{dir:"left"})}),u.signUpButtonClicked.attach(function(){}),i.start=function(){u.start()},i.hide=function(o,n){l=!1,t(),u.hide(function(){u.clearDetails(),"function"==typeof o&&o()},n)},i.show=function(o,n){l=!0,u.show(function(){e(),"function"==typeof o&&o()},n)},i}(),logOutController=function(){function o(o){return"undefined"!=typeof o&&o.logoutNoPopup?(n(),!0):void Popup.createPopUp("Are you sure?","Once you logout, You will not be able to see all content.",function(){n()},function(){debug&&console.log("Cool the user didnt log out!")})}function n(){return i.getToken()&&i.getUser()?(e.showLoader(),void handlerController.logout({hash:i.getToken()},function(o){return debug&&console.log(o),debug&&console.log("we have logged out!"),i.removeUser(),globalEvent.notify("user:loggedout"),e.hideLoader(),!0},function(o){return debug&&console.error("Could not log out, error: "+o),i.removeUser(),globalEvent.notify("user:loggedout"),e.hideLoader(),!1})):(i.removeUser(),!0)}var e={},t=null,i=userModel;return globalEvent.attach("app:ready",function(){e.start()}),globalEvent.attach("user:logout",function(n){o(n)}),e.showLoader=function(){$(".disable-overlay").addClass("show"),e.hideLoader(!0),$("body").append(t())},e.hideLoader=function(o){o||$(".disable-overlay").removeClass("show"),$("body > .ajax-loader").remove()},e.start=function(){t=_.template($(".ajax-loader-template").html())},e}();