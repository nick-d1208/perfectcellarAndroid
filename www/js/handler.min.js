var handlerController=function(){"use strict";function t(t,e,n){$.ajax({url:i+t.url+("undefined"!=typeof t.ajaxParams?t.ajaxParams:""),type:"POST",headers:{},dataType:t.dataType||"json",data:JSON.stringify(t.data),success:function(t){try{var n;"object"==typeof t?n=t:(t=JSON.stringify(t),n=JSON.parse(t)),"function"==typeof e&&e(n)}catch(i){debug&&console.log("FAILED TO PARSE OBJECT, ERROR: "+i)}},complete:function(){},error:function(t,e,i){return t.status>=400?void("function"==typeof n&&n(t.responseText)):("function"==typeof n&&n(t.responseText),void(debug&&console.log("GENERIC ERROR: "+t.status+" "+e+" "+i+" "+t.responseText)))}})}function e(t,e,n){$.ajax({url:t.url,type:"GET",success:function(t){var n={yotpo:"",quizzes:[],lessons:[],wines:[]};try{var i=document.createElement("div");i.innerHTML=t;for(var o=i.getElementsByTagName("script"),s=o.length;s--;)o[s].parentNode.removeChild(o[s]);var r=$(i.innerHTML),u=r.find("#quizzes"),a=r.find("#lessons"),d=r.find("#wines"),f=r.find("#wines-ratings");u.find(">div").each(function(){var t=$(this),e=Number(t.attr("quiz"))-1,i=t.attr("name"),o=t.attr("img"),s={index:e,name:i,img:o,questions:[]};t.find("strong").each(function(e){var n=$.trim($(this).text()),i=[],o=0;t.find("ul").eq(e).find("li").each(function(t){$(this).find("a").length&&(o=t),i.push($.trim($(this).text()))}),s.questions.push({q:n,a:i,c:o})}),n.quizzes.push(s)}),n.quizzes.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),a.find(">div").each(function(){var t=$(this),e=Number(t.attr("set"))-1,i=[];t.find(">div").each(function(){var t={set:e,index:Number($(this).attr("lesson"))-1,title:$(this).find(">.title").text(),subtitle:$(this).find(">.subtitle").text(),imgs:{top:$(this).find(">.top-image").text(),middle:$(this).find(">.middle-image").text()},videos:{top:$(this).find(">.top-video").text(),bottom:$(this).find(">.bottom-video").text()},parts:[]};$(this).find(">.part").each(function(){var e={name:"part "+$(this).attr("number"),index:Number($(this).attr("index"))-1,icon:$(this).find(">.icon").text(),title:$(this).find(">.title").text(),subtitle:$(this).find(">.subtitle").text(),img:$(this).find(">.img").text(),p:[]};$(this).find(">.p").each(function(){e.p.push($(this).html())}),t.parts.push(e)}),t.parts.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),i.push(t)}),i.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),n.lessons.push(i)}),n.lessons.sort(function(t,e){return t[0].set>e[0].set?1:e[0].set>t[0].set?-1:0}),d.find(">[set]").each(function(){var t=$(this),e=Number(t.attr("set"))-1,i=[];t.find(">div").each(function(){var t=Number($(this).attr("wine")),n={price:$(this).find(">.price").text(),purl:$(this).attr("url"),variant:$(this).attr("vid"),set:e,index:t-1,title:$(this).find(">.title").text(),subtitle:$(this).find(">.subtitle").text(),img:$(this).find(">.top-image").text(),sections:[],video:$(this).find(">.bottom-video").text(),pimg:$(this).find(">.pimage").text(),rating:f.find('[set="'+(e+1)+'"][wine="'+t+'"]').html()};$(this).find(">[section]").each(function(){var t={index:Number($(this).attr("section"))-1,title:$(this).find(">.title").text(),img:$(this).find(">.image").text(),p:[],video:$(this).find(">.video").text()};$(this).find(">.p").each(function(){t.p.push($(this).html())}),n.sections.push(t)}),n.sections.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),i.push(n)}),i.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),n.wines.push(i)}),n.wines.sort(function(t,e){return t[0].set>e[0].set?1:e[0].set>t[0].set?-1:0}),n.discount={value:Number(d.find(">.discount-value").text()),text:d.find(">.discount-text").text()},n.yotpo=f.attr("url")}catch(c){return n=null,debug&&console.log("FAILED, ERROR: "+c),!1}"function"==typeof e&&e(n)},complete:function(){},error:function(t,e,i){return t.status>=400?void("function"==typeof n&&n(t.responseText)):("function"==typeof n&&n(t.responseText),void(debug&&console.log("GENERIC ERROR: "+t.status+" "+e+" "+i+" "+t.responseText)))}})}var n={},i="http://www.perfcellapi.vitaminlabs.co.uk/",o="logIn.php",s="getUInfo.php",r="logOut.php",u="forgotPasswd.php",a="http://www.perfectcellar.com/pages/e2-98-15-d5-f7-ed-3a-9f-c7-4b";return n.content=function(t,n,i){if("object"!=typeof t)return debug&&console.error("Params are undefined!"),!1;var o={url:a+objectToAjaxParameters({time:(new moment).unix()})};debug&&console.log(o),e(o,n,i)},n.getinfo=function(e,n,i){if("object"!=typeof e)return debug&&console.error("Params are undefined!"),!1;var o={url:s,data:e};debug&&console.log(o),t(o,n,i)},n.forgotpassword=function(e,n,i){if("object"!=typeof e)return debug&&console.error("Params are undefined!"),!1;var o={url:u,data:e};debug&&console.log(o),t(o,n,i)},n.login=function(e,n,i){if("object"!=typeof e)return debug&&console.error("Params are undefined!"),!1;var s={url:o,data:e};debug&&console.log(s),t(s,n,i)},n.logout=function(e,n,i){if("object"!=typeof e)return debug&&console.error("Params are undefined!"),!1;var o={url:r,data:e};debug&&console.log(o),t(o,n,i)},n}();